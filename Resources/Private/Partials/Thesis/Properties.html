{namespace v=FluidTYPO3\Vhs\ViewHelpers}
<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" data-namespace-typo3-fluid="true">
	<v:variable.set name="nextStep" value="{v:math.sum(a: '{step}', fail: 1, b: '1')}" />
	<v:variable.set name="previousStep" value="{v:math.subtract(a: '{step}', fail: 1, b: '1')}" />
	<v:variable.set name="opinion" value="{v:variable.get(name: 'result.opinions.{previousStep}')}" />

	<f:for each="{theses}" as="thesis" iteration="iterator">
		<f:if condition="{iterator.cycle} == {step}">
			<div class="row mb-3">
				<div class="col-12">
					<div class="thesis-balloon-wrap">
						<div class="hidden-xs-down">
							<f:if condition="{step} == 0">
								<f:then>
									<div class="thesis-control-prev">
										<f:link.page pageUid="1">
											<i class="fi flaticon-arrow2 flaticon-arrow2-reverse"></i>
										</f:link.page>
									</div></f:then>
								<f:else>
									<div class="thesis-control-prev">
										<f:link.action action="questionnaire" controller="Election" arguments="{election: election, electionDistrict: electionDistrict, step: '{v:math.subtract(a: \'{step}\', fail: 1, b: \'1\')}'}">
											<i class="fi flaticon-arrow2 flaticon-arrow2-reverse"></i>
										</f:link.action>
									</div>
								</f:else>
							</f:if>
							<f:if condition="{opinion.uidLocal}">
								<f:render partial="Sharing/Header" arguments="{electionDistrict: electionDistrict, election: election, thesis: thesis}"/>
								<f:form class="thesis-control-next" additionalParams="{tx_kom_pi1: '{electionDistrict: electionDistrict, election: election, step: nextStep}'}" object="{resultObject}" objectName="resultObject">
									<f:form.hidden name="resultObject[opinions][{step}][uidLocal]" value="{thesis.uid}" />
									<f:form.button class="unstyled" name="resultObject[opinions][{step}][opinion]" value="{opinion.opinion}">
										<i class="fi flaticon-arrow2"></i>
									</f:form.button>
								</f:form>
							</f:if>
							<div class="text-right">
								These <strong>{step}</strong> von {totalSteps}
							</div>
						</div>
						<div class="thesis-balloon">
							<div class="content">
								<h2>{thesis.title}</h2>
								<f:format.raw>{thesis.description}</f:format.raw>
							</div>
						</div>
						<div>
							<f:form additionalParams="{tx_kom_pi1: '{electionDistrict: electionDistrict, election: election, step: nextStep}'}" object="{resultObject}" objectName="resultObject">
								<f:form.hidden name="resultObject[opinions][{step}][uidLocal]" value="{thesis.uid}" />
								<f:form.button class="skip-thesis float-right" name="resultObject[opinions][{step}][opinion]" value="0">
									These Ã¼berspringen
									<i class="fi flaticon-arrow2"></i>
								</f:form.button>
							</f:form>
						</div>
					</div>
				</div>
			</div>
			<div class="row my-3">
				<div class="col-12">
					<f:form additionalParams="{tx_kom_pi1: '{electionDistrict: electionDistrict, election: election, step: nextStep}'}" object="{resultObject}" objectName="resultObject">
						<f:form.hidden name="resultObject[opinions][{step}][uidLocal]" value="{thesis.uid}" />
						<div class="row">
							<div class="col col-auto mx-auto mb-3">
								<span class="d-flex align-items-center">
									<span class="emphasize-toggle mr-1">
										<f:form.checkbox id="emphasize-{step}" class="checkbox-star" value="1" checked="{opinion.emphasize}" name="resultObject[opinions][{step}][emphasize]" />
										<label for="emphasize-{step}"></label>
									</span>
									These gewichten
								</span>
							</div>
						</div>
						<div class="row">
							<div class="col-12 col-sm-4 d-flex">
								<f:form.button class="btn btn-lg btn-block btn-secondary{f:if(condition: '{opinion.opinion} == 2', then: ' active')}" name="resultObject[opinions][{step}][opinion]" value="2">
									<span class="d-flex align-items-center">
										ich stimme zu
										<span class="opinion-wrap">
											<i class="fi flaticon-check"></i>
										</span>
									</span>
								</f:form.button>
							</div>
							<div class="col-12 col-sm-4 mt-3 mt-sm-0">
								<f:form.button class="btn btn-lg btn-block btn-secondary{f:if(condition: '{opinion.opinion} == -1', then: ' active')}" name="resultObject[opinions][{step}][opinion]" value="-1">
									<span class="d-flex align-items-center">
										ich stimme nicht zu
										<span class="opinion-wrap">
											<i class="fi flaticon-cancel"></i>
										</span>
									</span>
								</f:form.button>
							</div>
							<div class="col-12 col-sm-4 mt-3 mt-sm-0">
								<f:form.button class="btn btn-lg btn-block btn-secondary{f:if(condition: '{opinion.opinion} == 1', then: ' active')}" name="resultObject[opinions][{step}][opinion]" value="1">
									<span class="d-flex align-items-center">
										neutral
										<span class="opinion-wrap">
											<i class="fi flaticon-minus"></i>
										</span>
									</span>
								</f:form.button>
							</div>
						</div>
					</f:form>
					<div class="row justify-content-center mt-3">
						<div class="col col-auto">
							<f:render partial="Sharing/Thesis" arguments="{text: 'These teilen', electionDistrict: electionDistrict, election: election, thesis: thesis}"/>
						</div>
					</div>
				</div>
			</div>
		</f:if>
	</f:for>
</html>
